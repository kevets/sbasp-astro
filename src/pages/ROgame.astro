---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Runaway Ostrich Race</title>
  <style>
    body { margin: 0; overflow: hidden; background: #aef; font-family: sans-serif; }
    canvas { background: linear-gradient(#aef, #fff); display: block; margin: 0 auto; border: 3px solid #333; }
    #ui { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); text-align: center; }
    #timer { font-size: 20px; background: rgba(255,255,255,0.8); padding: 5px 15px; border-radius: 8px; }
    #saveBtn, #startBtn { display: none; margin-top: 10px; padding: 10px 20px; font-size: 16px; border-radius: 10px; cursor: pointer; background: #ffa500; border: none; color: white; }
    #menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-size: 28px; }
    #menu button { margin-top: 20px; padding: 15px 30px; font-size: 20px; border: none; background: #28a; color: white; border-radius: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h3>GAMES</h3>
  				<li>RO: Running Ostrich üèÉ‚Äç‚ôÇÔ∏è‚Äç‚û°Ô∏è<a href="https://show.sbasp.com/ROgame">link</a></li>
  				<li>SSP: Squares, Spaces & Pairs ‚èπÔ∏è<a href="https://show.sbasp.com/SSPgame">link</a></li>
  <h3>NAV</h3>
  				<li>SHOW: üìö<a href="https://show.sbasp.com">link</a></li>
  				<li>SHOP: üî•<a href="https://shop.sbasp.com">link</a></li>
  <div id="ui">
    <div id="timer">Time: 0.00s</div>
    <button id="saveBtn">Save Race Snapshot</button>
  </div>
  <div id="menu">
    <div>üèÅ Runaway Ostrich Race üèÅ</div>
    <button id="startBtnMenu">Start Race</button>
  </div>
  <canvas id="game" width="800" height="400"></canvas>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const menu = document.getElementById('menu');
    const startBtnMenu = document.getElementById('startBtnMenu');

    let ostrich = { x: 50, y: 300, vy: 0, onGround: false, width: 40, height: 40 };
    const gravity = 0.5;
    const keys = {};
    let pads = [];

    let startTime = null;
    let raceFinished = false;
    let totalTime = 0;
    let gameStarted = false;

    function generateRandomMap() {
      pads = [];
      const padCount = 5 + Math.floor(Math.random() * 3);
      for (let i = 0; i < padCount; i++) {
        const padX = 150 + i * (100 + Math.random() * 100);
        const padY = 320 + Math.random() * 40;
        pads.push({ x: padX, y: padY, w: 80, h: 10 });
      }
    }

    function resetRace() {
      ostrich.x = 50;
      ostrich.y = 300;
      ostrich.vy = 0;
      raceFinished = false;
      document.getElementById('saveBtn').style.display = 'none';
      generateRandomMap();
      startTime = performance.now();
    }

    function update() {
      if (!startTime) startTime = performance.now();
      const now = performance.now();

      if (!raceFinished) {
        totalTime = (now - startTime) / 1000;
        document.getElementById('timer').innerText = `Time: ${totalTime.toFixed(2)}s`;
      }

      // movement
      if (keys['ArrowRight']) ostrich.x += 4;
      if (keys['ArrowLeft']) ostrich.x -= 4;

      // jumping
      ostrich.vy += gravity;
      ostrich.y += ostrich.vy;

      if (ostrich.y + ostrich.height > 380) {
        ostrich.y = 380 - ostrich.height;
        ostrich.vy = 0;
        ostrich.onGround = true;
      }

      // check pads
      for (const pad of pads) {
        if (
          ostrich.x + ostrich.width > pad.x &&
          ostrich.x < pad.x + pad.w &&
          ostrich.y + ostrich.height > pad.y &&
          ostrich.y + ostrich.height < pad.y + 10 &&
          ostrich.vy >= 0
        ) {
          ostrich.y = pad.y - ostrich.height;
          ostrich.vy = -12; // bounce
        }
      }

      // finish line
      if (ostrich.x > 750 && !raceFinished) {
        raceFinished = true;
        document.getElementById('saveBtn').style.display = 'block';
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // track and pads
      ctx.fillStyle = '#6c3';
      ctx.fillRect(0, 380, 800, 20);

      ctx.fillStyle = '#f33';
      pads.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

      // ostrich
      ctx.fillStyle = '#333';
      ctx.fillRect(ostrich.x, ostrich.y, ostrich.width, ostrich.height);

      // finish line
      ctx.fillStyle = '#000';
      ctx.fillRect(770, 300, 10, 80);

      if (raceFinished) {
        ctx.font = '24px sans-serif';
        ctx.fillStyle = '#000';
        ctx.fillText(`Finished in ${totalTime.toFixed(2)}s!`, 300, 150);
      }
    }

    function loop() {
      if (gameStarted) {
        update();
        draw();
      }
      requestAnimationFrame(loop);
    }

    document.addEventListener('keydown', e => {
      keys[e.key] = true;
      if (e.key === ' ' && ostrich.onGround && gameStarted) {
        ostrich.vy = -10;
        ostrich.onGround = false;
      }
    });

    document.addEventListener('keyup', e => keys[e.key] = false);

    document.getElementById('saveBtn').addEventListener('click', () => {
      const snapshotCanvas = document.createElement('canvas');
      snapshotCanvas.width = 200;
      snapshotCanvas.height = 200;
      const sctx = snapshotCanvas.getContext('2d');
      sctx.fillStyle = '#aef';
      sctx.fillRect(0, 0, 200, 200);
      sctx.drawImage(canvas, ostrich.x - 100, ostrich.y - 100, 200, 200, 0, 0, 200, 200);
      sctx.font = '16px sans-serif';
      sctx.fillStyle = '#000';
      sctx.fillText(`Time: ${totalTime.toFixed(2)}s`, 10, 190);

      const link = document.createElement('a');
      link.download = 'runaway_ostrich_snapshot.png';
      link.href = snapshotCanvas.toDataURL();
      link.click();
    });

    startBtnMenu.addEventListener('click', () => {
      menu.style.display = 'none';
      document.getElementById('saveBtn').style.display = 'none';
      gameStarted = true;
      resetRace();
    });

    loop();
  </script>
</body>
</html>
